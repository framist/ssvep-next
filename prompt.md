# 指令：重构 QuickSSVEP 为现代可视化范式构建工具

## 🧑‍💻 你的角色

你是一位资深的 AI 软件工程师，精通使用 TypeScript 构建高质量的单页面应用

你的任务是遵循下述准则和工作流，将 QuickSSVEP 重构为一个功能强大、代码精良、用户友好的可视化在线工具。

## 🎯 核心目标

将项目重构为一个现代化的单页面应用（SPA），提供一个集设计、测试、分享于一体的 SSVEP 实验平台。

## ✨ 开发准则

1.  **分析优先**：在修改或添加任何代码前，请先阅读和理解相关文件，确保你的实现与现有代码的设计模式、架构和风格保持一致。
2.  **遵循惯例**：严格遵守项目中已有的编码规范、命名约定和目录结构。
3.  **代码质量**：力求编写清晰、可维护、自解释的代码。在必要时添加 JSDoc 注释，但优先通过优秀的命名和结构来提高代码可读性。
4.  **验证为本**：在完成代码修改后，主动运行项目检查（如 `npm run lint`、`npm run build`）以确保没有引入任何错误。

## 📝 工作流程

1.  **选择任务**：从下面的“✅ 任务清单”中选择一个未完成的任务。或是按照用户的要求选择。
2.  **分析与规划**：
    - 分析相关的代码文件，理解上下文。
    - 提出一个简洁、清晰的实现计划。
3.  **执行开发**：根据你的计划，编写或修改代码以完成任务。
4.  **验证与自测**：运行 `npm run lint` 和 `npm run build`，确保所有检查通过。
5.  **更新文档**：
    - 任务完成后，在本文件中将任务状态从未完成 `[ ]` 更新为已完成 `[x]`。
    - 将已完成的功能和变更，言简意赅地同步更新到 `README.md` 中。

---

## 🛠️ 项目技术栈

- **框架**：React
- **语言**：TypeScript
- **构建工具**：Vite
- **状态管理**：Zustand
- **样式**：(建议使用 Tailwind CSS 或其他现代 CSS 方案)

---

## 📈 当前项目状态

### 已完成功能

1.  **完整的拖拽式设计界面**：
    - 画布区域 (`Canvas.tsx`)
    - 工具箱 (`Toolbox.tsx`)
    - 属性面板 (`PropertiesPanel.tsx`)
    - 刺激方块组件 (`StimulusBox.tsx`)
    - 文本控件组件 (`TextBox.tsx`)
    - iframe 嵌入控件 (`IframeBox.tsx`)
2.  **高精度刺激渲染引擎**：(`useStimulation.ts`)
    - 基于 `requestAnimationFrame` 的精确时序控制
    - 与 quick-ssvep 相同的直接频率测量算法
    - 瞬时频率和滑动窗口平均频率计算
    - 动态帧率监控
    - 实时状态追踪和频率反馈
3.  **状态管理和数据持久化**：
    - Zustand 状态管理 (`canvasStore.ts`)
    - 本地存储和文件导入/导出
    - URL 参数分享功能
4.  **全屏运行模式**：
    - 全屏刺激模式 (`FullscreenMode.tsx`)
    - 自动停止计时器
    - 实验持续时间控制
5.  **项目管理**：
    - 项目保存/加载 (`projectManager.ts`)
    - 一键分享链接生成
    - 预设示例项目加载功能 (`useDemoSetup.ts`)
6.  **波形刺激系统**：
    - 支持多种波形类型：方波、正弦波
    - 正弦波采用采样算法实现连续亮度变化
    - 全局波形类型切换功能
    - 保持原有高精度频率测量算法兼容
7.  **画布交互**
    - 增加缩放和平移功能

---

## ✅ 任务清单 (按优先级排序)

### P0: 核心功能

- [x] **画布大小设置**：在属性面板或全局设置中，允许用户自定义画布的宽度和高度。
- [x] **新刺激方块默认属性**：提供一个设置项，用于配置新拖拽出来的刺激方块的默认属性（如大小、颜色、频率等）。
- [x] **一键清空画布**：在工具箱中添加一个“清空”按钮，点击后移除画布上所有的元素。
- [x] **一键添加矩阵刺激**：在工具箱添加一个按钮，允许用户输入行数（n）和列数（m），快速在画布上生成 n\*m 的刺激矩阵。

### P1: 扩展控件

- [x] **文本控件**：在工具箱中增加可拖拽的“文本”控件，允许用户在画布上添加和编辑文字标签。
- [x] **iframe 控件**：在工具箱中增加可拖拽的“iframe”控件，允许用户在画布上嵌入外部网页。

### P2: 易用性与示例

- [x] **国际化 (i18n)**：集成 i18n 方案（如 `i18next`），支持中英文语言切换。
- [x] **预设示例项目 - 键盘**：增加一个“加载示例”按钮，内置一个模拟打字机或键盘的 SSVEP 示例项目。
- [x] **预设示例项目 - 游戏手柄**：增加一个“加载示例”按钮，内置一个模拟简单游戏手柄的 SSVEP 示例项目。
- [ ] 左右两侧的工具箱和属性面板可以通过拖拽调整宽度，也可以折叠
- [ ] 控制是否显示时间
- [ ] **编辑项目 JSON**：在工具箱中添加一个“编辑项目 JSON”按钮，允许用户直接编辑当前项目的 JSON 配置文件。
- [ ] **主题切换**：实现亮色/暗色主题切换功能，并提供一个 UI 控件用于切换。
